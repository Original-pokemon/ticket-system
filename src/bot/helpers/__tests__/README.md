# –¢–µ—Å—Ç—ã –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –±–æ—Ç–∞

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–æ—Ç –∫–∞—Ç–∞–ª–æ–≥ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ—Å—Ç—ã –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è–º –∏ –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º.

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —Ç–µ—Å—Ç–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Vitest:

```bash
npm install -D vitest @vitest/ui @vitest/coverage-v8
```

## üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º (watch mode)
```bash
npm test
```

### –û–¥–Ω–æ–∫—Ä–∞—Ç–Ω—ã–π –∑–∞–ø—É—Å–∫
```bash
npm run test:run
```

### –° UI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º
```bash
npm run test:ui
```

### –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞
```bash
npm run test:coverage
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

- `mocks.ts` - –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è mock –æ–±—ä–µ–∫—Ç–æ–≤
- `send-notification.test.ts` - –¢–µ—Å—Ç—ã –¥–ª—è `sendTaskPerformers` –∏ `sendManagers`

## üîç –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è

### `sendTaskPerformers`
- ‚úÖ –£—Å–ø–µ—à–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤—Å–µ–º –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è–º
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ —Ç–∏–∫–µ—Ç–µ
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤ —Å–µ—Å—Å–∏–∏
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑ API
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞—è, –∫–æ–≥–¥–∞ –Ω–µ—Ç –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —á–∞—Å—Ç–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫ (–Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–µ —É–¥–∞–ª–∏—Å—å)
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–ª–∞ (–≤—Å–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–µ —É–¥–∞–ª–∏—Å—å)
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ —Å inline keyboard markup
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤ —Ä–∞–±–æ—Ç—ã

### `sendManagers`
- ‚úÖ –£—Å–ø–µ—à–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤—Å–µ–º –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è ID –ê–ó–°
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ê–ó–° –∏–∑ API
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞—è, –∫–æ–≥–¥–∞ –Ω–µ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –¥–ª—è –ê–ó–°
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —á–∞—Å—Ç–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–ª–∞
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ —Å inline keyboard markup
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤ —Ä–∞–±–æ—Ç—ã

## üìä –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞

–¶–µ–ª—å - –º–∏–Ω–∏–º—É–º 80% –ø–æ–∫—Ä—ã—Ç–∏—è –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.

## üêõ –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
1. ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ `await` –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `sendTaskPerformers` - **–ò–°–ü–†–ê–í–õ–ï–ù–û**
   - `bot/src/bot/handlers/user/ticket/transfer-ticket-handler.ts:134`
   - `bot/src/bot/handlers/user/ticket/ticket-action.handlers.ts:213`

2. ‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ - **–£–õ–£–ß–®–ï–ù–û**
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –ª–æ–≥–∏ –Ω–∞ –≤—Å–µ—Ö —ç—Ç–∞–ø–∞—Ö
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (ticket ID, title)

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è mock'–æ–≤

### –°–æ–∑–¥–∞–Ω–∏–µ mock context
```typescript
const ctx = createMockContext(
  ["user-1", "user-2"], // task performers
  ["manager-1"]         // managers
);
```

### –°–æ–∑–¥–∞–Ω–∏–µ mock ticket
```typescript
const ticket = createMockTicket({
  id: "custom-id",
  title: "Custom Title",
  ticket_category: "cat-123",
});
```

### –ú–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏
```typescript
ctx.api!.sendMessage = vi.fn().mockRejectedValue(new Error("Bot blocked"));
```

## üìù –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ñ–∞–π–ª `*.test.ts` –≤ –∫–∞—Ç–∞–ª–æ–≥–µ `__tests__`
2. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ mock'–∏ –∏–∑ `mocks.ts`
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É `describe` -> `it` -> `expect`
4. –û—á–∏—â–∞–π—Ç–µ mock'–∏ –≤ `beforeEach` –∏ `afterEach`

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- [`send-notification.ts`](../send-notification.ts) - –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ —Ñ—É–Ω–∫—Ü–∏–π
- [`vitest.config.ts`](../../../../vitest.config.ts) - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Vitest
- [`package.json`](../../../../package.json) - NPM —Å–∫—Ä–∏–ø—Ç—ã

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [Vitest](https://vitest.dev/)
- [Vitest API Reference](https://vitest.dev/api/)
- [Vi Mock Functions](https://vitest.dev/api/vi.html#vi-fn)
